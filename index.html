<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Strike Hours Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
        }
        
        .container {
            max-width: 400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 14px;
        }
        
        .weekly-progress {
            padding: 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #eee;
        }
        
        .progress-bar {
            background: #e9ecef;
            border-radius: 10px;
            height: 20px;
            overflow: hidden;
            margin-bottom: 10px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #20c997);
            transition: width 0.3s ease;
            border-radius: 10px;
        }
        
        .progress-text {
            text-align: center;
            font-weight: bold;
            color: #495057;
        }
        
        .current-week {
            text-align: center;
            color: #6c757d;
            font-size: 14px;
            margin-bottom: 10px;
        }
        
        .main-content {
            padding: 20px;
        }
        
        .add-hours-section {
            margin-bottom: 30px;
        }
        
        .section-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #343a40;
        }
        
        .paste-area {
            width: 100%;
            min-height: 120px;
            padding: 15px;
            border: 2px dashed #dee2e6;
            border-radius: 10px;
            font-family: monospace;
            font-size: 14px;
            resize: vertical;
            margin-bottom: 15px;
        }
        
        .paste-area:focus {
            border-color: #007bff;
            outline: none;
        }
        
        .btn {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,123,255,0.3);
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
            margin-top: 10px;
        }
        
        .manual-entry {
            display: none;
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #495057;
        }
        
        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 5px;
            font-size: 16px;
        }
        
        .hours-log {
            margin-top: 30px;
        }
        
        .log-entry {
            padding: 15px;
            margin-bottom: 10px;
            background: #f8f9fa;
            border-left: 4px solid #007bff;
            border-radius: 5px;
        }
        
        .log-date {
            font-weight: bold;
            color: #495057;
        }
        
        .log-hours {
            color: #28a745;
            font-weight: bold;
        }
        
        .log-times {
            font-size: 14px;
            color: #6c757d;
        }
        
        .alert {
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 5px;
            font-weight: bold;
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f1b0b7;
        }
        
        .empty-state {
            text-align: center;
            color: #6c757d;
            font-style: italic;
            padding: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚ö° Strike Hours</h1>
            <p>Henry Ford Genesys RN Strike</p>
        </div>
        
        <div class="weekly-progress">
            <div class="current-week" id="currentWeek"></div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-text" id="progressText">0 / 24 hours</div>
        </div>
        
        <div class="main-content">
            <div class="add-hours-section">
                <h2 class="section-title">üìß Add Hours from Email</h2>
                <textarea 
                    class="paste-area" 
                    id="emailPaste" 
                    placeholder="Paste your confirmation email here...

Example:
Thanks for filling out RN Strike Sign Out - Week 1 
Email: your.email@gmail.com
Full Name: Your Name
Choose Current Day: Thursday, September 4, 2025
Sign Out Time: 06:25 AM"></textarea>
                
                <button class="btn btn-primary" onclick="parseEmail()">
                    üìä Parse Hours
                </button>
                
                <button class="btn btn-secondary" onclick="toggleManualEntry()">
                    ‚úèÔ∏è Manual Entry
                </button>
                
                <div class="manual-entry" id="manualEntry">
                    <h3>Manual Entry</h3>
                    <div class="form-group">
                        <label>Date:</label>
                        <input type="date" class="form-control" id="manualDate">
                    </div>
                    <div class="form-group">
                        <label>Clock In Time:</label>
                        <input type="time" class="form-control" id="manualTimeIn">
                    </div>
                    <div class="form-group">
                        <label>Clock Out Time:</label>
                        <input type="time" class="form-control" id="manualTimeOut">
                    </div>
                    <button class="btn btn-primary" onclick="addManualEntry()">
                        ‚ûï Add Hours
                    </button>
                </div>
            </div>
            
            <div id="alertContainer"></div>
            
            <div class="hours-log">
                <h2 class="section-title">üìã This Week's Hours</h2>
                <div id="hoursLog">
                    <div class="empty-state">
                        No hours logged yet. Paste your first confirmation email above!
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Data storage
        let hoursData = JSON.parse(localStorage.getItem('strikeHours') || '[]');
        
        // Initialize
        updateDisplay();
        setCurrentWeek();
        
        function setCurrentWeek() {
            const now = new Date();
            const startOfWeek = new Date(now);
            startOfWeek.setDate(now.getDate() - now.getDay()); // Sunday
            
            const endOfWeek = new Date(startOfWeek);
            endOfWeek.setDate(startOfWeek.getDate() + 6);
            
            const formatDate = (date) => {
                return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
            };
            
            document.getElementById('currentWeek').textContent = 
                `Week of ${formatDate(startOfWeek)} - ${formatDate(endOfWeek)}`;
        }
        
        function parseEmail() {
            const emailText = document.getElementById('emailPaste').value.trim();
            
            if (!emailText) {
                showAlert('Please paste your confirmation email first!', 'warning');
                return;
            }
            
            try {
                const parsed = extractDataFromEmail(emailText);
                if (parsed) {
                    addHoursEntry(parsed);
                    document.getElementById('emailPaste').value = '';
                    showAlert(`Successfully added ${parsed.hours || 'partial'} hours for ${parsed.date}!`, 'success');
                } else {
                    showAlert('Could not parse email. Try manual entry or check the email format.', 'danger');
                }
            } catch (error) {
                showAlert('Error parsing email: ' + error.message, 'danger');
            }
        }
        
        function extractDataFromEmail(emailText) {
            // Extract sign in/out indicator
            const isSignOut = emailText.toLowerCase().includes('sign out') || emailText.toLowerCase().includes('sign **out**');
            const isSignIn = emailText.toLowerCase().includes('sign in') || emailText.toLowerCase().includes('sign **in**');
            
            // Extract date
            const dateRegex = /(?:Choose Current Day|Current Day)[^]*?(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday)[^]*?(\w+ \d{1,2}, \d{4})/i;
            const dateMatch = emailText.match(dateRegex);
            
            if (!dateMatch) {
                throw new Error('Could not find date in email');
            }
            
            const dateStr = dateMatch[2];
            const date = new Date(dateStr).toISOString().split('T')[0];
            
            // Extract time - handle multiple formats and variations
            let timeMatch;
            let hours, minutes, ampm;
            
            // Method 1: Look for time pattern with various separators
            // Handles: "06:**:25 AM", "06*****25 AM", "06 25 AM", etc.
            timeMatch = emailText.match(/(\d{1,2})\s*[\*\:\-\s]*\s*(\d{2})\s*(AM|PM)/i);
            
            if (timeMatch) {
                hours = parseInt(timeMatch[1]);
                minutes = parseInt(timeMatch[2]);
                ampm = timeMatch[3].toUpperCase();
            } else {
                // Method 2: Look for "Sign Out Time" section and extract numbers
                const timeSection = emailText.match(/Sign\s+(?:In|Out)\s+Time[\s\S]*?(AM|PM)/i);
                if (timeSection) {
                    const numbers = timeSection[0].match(/\d{1,2}/g);
                    const ampmMatch = timeSection[0].match(/(AM|PM)/i);
                    
                    if (numbers && numbers.length >= 2 && ampmMatch) {
                        hours = parseInt(numbers[0]);
                        minutes = parseInt(numbers[1]);
                        ampm = ampmMatch[1].toUpperCase();
                    }
                }
            }
            
            if (!hours && !minutes && !ampm) {
                // Method 3: Extract all numbers and AM/PM, make best guess
                const allNumbers = emailText.match(/\d{1,2}/g);
                const ampmMatch = emailText.match(/(AM|PM)/i);
                
                if (allNumbers && allNumbers.length >= 2 && ampmMatch) {
                    // Take the last two numbers before AM/PM as time
                    hours = parseInt(allNumbers[allNumbers.length - 2]);
                    minutes = parseInt(allNumbers[allNumbers.length - 1]);
                    ampm = ampmMatch[1].toUpperCase();
                    
                    // Validate time makes sense
                    if (hours > 12 || minutes > 59) {
                        throw new Error('Could not parse time from email. Please try manual entry.');
                    }
                }
            }
            
            if (!hours && !minutes && !ampm) {
                throw new Error('Could not find time in email. Please use manual entry or check email format.');
            }
            
            // Convert to 24-hour format
            let hour24 = hours;
            if (ampm === 'PM' && hours !== 12) hour24 += 12;
            if (ampm === 'AM' && hours === 12) hour24 = 0;
            
            const timeStr = `${hour24.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
            
            return {
                date: date,
                time: timeStr,
                type: isSignOut ? 'out' : 'in',
                rawEmail: emailText
            };
        }
        
        function addHoursEntry(entry) {
            // Find existing entry for this date
            let existingIndex = hoursData.findIndex(item => item.date === entry.date);
            
            if (existingIndex === -1) {
                // New entry
                hoursData.push({
                    date: entry.date,
                    timeIn: entry.type === 'in' ? entry.time : null,
                    timeOut: entry.type === 'out' ? entry.time : null,
                    hours: 0
                });
                existingIndex = hoursData.length - 1;
            } else {
                // Update existing entry
                if (entry.type === 'in') {
                    hoursData[existingIndex].timeIn = entry.time;
                } else {
                    hoursData[existingIndex].timeOut = entry.time;
                }
            }
            
            // Calculate hours if both times are present
            const item = hoursData[existingIndex];
            if (item.timeIn && item.timeOut) {
                item.hours = calculateHours(item.timeIn, item.timeOut);
                
                // Smart week assignment: if this is a cross-day shift that started before 7 AM,
                // we might need to adjust the date to reflect when the shift actually started
                const [inHours] = item.timeIn.split(':').map(Number);
                const [outHours] = item.timeOut.split(':').map(Number);
                
                // If someone clocked in after 7 AM but clocked out before 7 AM (next day),
                // this is clearly an overnight shift and the hours belong to the start day
                if (inHours >= 7 && outHours < 7) {
                    // This is handled correctly - hours go to the date they clocked in
                }
                
                // If someone clocked in before 7 AM, the shift actually belongs to the previous day
                if (inHours < 7) {
                    const adjustedDate = new Date(item.date);
                    adjustedDate.setDate(adjustedDate.getDate() - 1);
                    item.shiftDate = adjustedDate.toISOString().split('T')[0];
                } else {
                    item.shiftDate = item.date;
                }
            }
            
            saveData();
            updateDisplay();
        }
        
        function calculateHours(timeIn, timeOut) {
            const [inHours, inMinutes] = timeIn.split(':').map(Number);
            const [outHours, outMinutes] = timeOut.split(':').map(Number);
            
            let inTotal = inHours * 60 + inMinutes;
            let outTotal = outHours * 60 + outMinutes;
            
            // Handle shifts that cross 7 AM boundary
            // If someone clocks in before 7 AM and out after 7 AM, 
            // or clocks in one day and out the next day
            if (outTotal < inTotal) {
                outTotal += 24 * 60; // Add 24 hours for next day
            }
            
            const totalMinutes = outTotal - inTotal;
            return Math.round((totalMinutes / 60) * 100) / 100; // Round to 2 decimal places
        }
        
        function toggleManualEntry() {
            const manual = document.getElementById('manualEntry');
            manual.style.display = manual.style.display === 'none' ? 'block' : 'none';
            
            if (manual.style.display === 'block') {
                document.getElementById('manualDate').value = new Date().toISOString().split('T')[0];
            }
        }
        
        function addManualEntry() {
            const date = document.getElementById('manualDate').value;
            const timeIn = document.getElementById('manualTimeIn').value;
            const timeOut = document.getElementById('manualTimeOut').value;
            
            if (!date || !timeIn || !timeOut) {
                showAlert('Please fill in all fields for manual entry', 'warning');
                return;
            }
            
            const hours = calculateHours(timeIn, timeOut);
            
            // Remove existing entry for this date
            hoursData = hoursData.filter(item => item.date !== date);
            
            // Add new entry
            hoursData.push({
                date: date,
                timeIn: timeIn,
                timeOut: timeOut,
                hours: hours
            });
            
            saveData();
            updateDisplay();
            
            // Clear form
            document.getElementById('manualTimeIn').value = '';
            document.getElementById('manualTimeOut').value = '';
            
            showAlert(`Successfully added ${hours} hours for ${date}!`, 'success');
            toggleManualEntry();
        }
        
        function getCurrentWeekHours() {
            const now = new Date();
            const startOfWeek = new Date(now);
            startOfWeek.setDate(now.getDate() - now.getDay()); // Sunday
            startOfWeek.setHours(0, 0, 0, 0);
            
            const endOfWeek = new Date(startOfWeek);
            endOfWeek.setDate(startOfWeek.getDate() + 6);
            endOfWeek.setHours(23, 59, 59, 999);
            
            return hoursData.filter(item => {
                const itemDate = new Date(item.date);
                return itemDate >= startOfWeek && itemDate <= endOfWeek;
            });
        }
        
        function updateDisplay() {
            // Update current week progress bar (always shows this week)
            const currentWeekData = getWeekHours(0);
            const currentWeekTotal = currentWeekData.hours.reduce((sum, item) => sum + (item.hours || 0), 0);
            
            // Update progress bar
            const progressPercent = Math.min((currentWeekTotal / 24) * 100, 100);
            document.getElementById('progressFill').style.width = progressPercent + '%';
            document.getElementById('progressText').textContent = `${currentWeekTotal.toFixed(1)} / 24 hours`;
            
            // Update the week view (could be different week)
            updateWeekDisplay();
            
            // Show warning if behind on hours (only for current week)
            if (currentWeekTotal < 24 && currentWeekOffset === 0) {
                const remaining = 24 - currentWeekTotal;
                if (remaining <= 8) {
                    showAlert(`‚ö†Ô∏è You need ${remaining.toFixed(1)} more hours this week for strike pay!`, 'warning');
                }
            }
        }
        
        function formatTime(timeStr) {
            const [hours, minutes] = timeStr.split(':').map(Number);
            const ampm = hours >= 12 ? 'PM' : 'AM';
            const displayHours = hours % 12 || 12;
            return `${displayHours}:${minutes.toString().padStart(2, '0')} ${ampm}`;
        }
        
        function showAlert(message, type) {
            const container = document.getElementById('alertContainer');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            
            container.innerHTML = '';
            container.appendChild(alert);
            
            setTimeout(() => {
                container.innerHTML = '';
            }, 5000);
        }
        
        function saveData() {
            localStorage.setItem('strikeHours', JSON.stringify(hoursData));
        }

        function editEntry(date) {
            const entry = hoursData.find(item => item.date === date);
            if (!entry) return;

            const editContainer = document.getElementById('editContainer');
            editContainer.innerHTML = `
                <div class="edit-form">
                    <h3>Edit Entry for ${new Date(date).toLocaleDateString('en-US', { weekday: 'long', month: 'short', day: 'numeric' })}</h3>
                    <div class="form-group">
                        <label>Clock In Time:</label>
                        <input type="time" class="form-control" id="editTimeIn" value="${entry.timeIn || ''}">
                    </div>
                    <div class="form-group">
                        <label>Clock Out Time:</label>
                        <input type="time" class="form-control" id="editTimeOut" value="${entry.timeOut || ''}">
                    </div>
                    <div class="edit-actions">
                        <button class="btn-save" onclick="saveEdit('${date}')">üíæ Save Changes</button>
                        <button class="btn-cancel" onclick="cancelEdit()">‚ùå Cancel</button>
                    </div>
                </div>
            `;
            
            // Scroll to edit form
            editContainer.scrollIntoView({ behavior: 'smooth' });
        }

        function saveEdit(date) {
            const timeIn = document.getElementById('editTimeIn').value;
            const timeOut = document.getElementById('editTimeOut').value;
            
            if (!timeIn || !timeOut) {
                showAlert('Please enter both clock in and clock out times', 'warning');
                return;
            }
            
            // Find and update the entry
            const entryIndex = hoursData.findIndex(item => item.date === date);
            if (entryIndex !== -1) {
                hoursData[entryIndex].timeIn = timeIn;
                hoursData[entryIndex].timeOut = timeOut;
                hoursData[entryIndex].hours = calculateHours(timeIn, timeOut);
                
                saveData();
                updateDisplay();
                cancelEdit();
                
                showAlert('Entry updated successfully!', 'success');
            }
        }

        function cancelEdit() {
            document.getElementById('editContainer').innerHTML = '';
        }

        function deleteEntry(date) {
            if (confirm(`Are you sure you want to delete the entry for ${new Date(date).toLocaleDateString('en-US', { weekday: 'long', month: 'short', day: 'numeric' })}?`)) {
                hoursData = hoursData.filter(item => item.date !== date);
                saveData();
                updateDisplay();
                showAlert('Entry deleted successfully!', 'success');
            }
        }
    </script>
</body>
</html>
